#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Refine chapters 211-215 of WenDao Legend
Add environmental descriptions, psychological portrayals, emotional moments, and battle visuals
"""

import os
import sys


def refine_chapter_211():
    """Refine Chapter 211: Night Light Cup"""
    filepath = 'drafts/volume_03/ch211_night_light_cup.md'
    
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()
    
    refinements = [
        # More environmental descriptions
        ('在湖边的一块黑色结晶岩上，一堆红色的"篝火"正在噼啪作响。',
         '在湖边的一块黑色结晶岩上，一堆红色的"篝火"正在噼啪作响。湖面平静如镜，倒映着穹顶上虚拟的星空，偶尔有数据流经过时泛起一圈圈涟漪，闪烁着莹蓝色的光芒。'),
        
        ('这是墨染用几个捡来的全息投影模块，外加一个损坏的声波发生器拼凑出来的"数字篝火"。',
         '这是墨染用几个捡来的全息投影模块，外加一个损坏的声波发生器拼凑出来的"数字篝火"。她特意调试了色温，让火光偏暖，那跳跃的橙红色在这片冷色调的世界里，显得格外温馨。'),
        
        # Emotional moments
        ('"那你呢？"墨染趴在膝盖上，侧着头看他，"你喝的这个是什么味的？酸的？甜的？"',
         '"那你呢？"墨染趴在膝盖上，侧着头看他，"你喝的这个是什么味的？酸的？甜的？"\n\n篝火的光芒在她脸上跳跃，将那双明亮的眼睛映得波光粼粼。萧千卷突然觉得，这样的墨染，少了平日里的张牙舞爪，多了几分少女该有的柔软。'),
        
        ('"苦的。"\n萧千卷看着杯中那深紫如墨的液体，眼神变得有些深邃，"但苦中回甘。"',
         '"苦的。"\n萧千卷看着杯中那深紫如墨的液体，眼神变得有些深邃，"但苦中回甘。"他的声音很轻，像是在自言自语，又像是在回答一个更深远的问题。'),
        
        # Psychological portrayals
        ('墨染看着篝火，沉默了一会儿。\n酒精（数据流）的作用让她的话变得多了起来，防备心也降到了最低。',
         '墨染看着篝火，沉默了一会儿。\n酒精（数据流）的作用让她的话变得多了起来，防备心也降到了最低。她很少这样安静，很少这样放松。在这个随时可能崩溃的世界里，她习惯了把自己武装成一只刺猬，用粗鲁和暴躁来掩饰内心的脆弱。但此刻，在这片短暂的安宁中，在这个可以托付后背的人身边，她终于卸下了伪装。'),
        
        ('"以前……"墨染突然开口，声音有些哑，',
         '"以前……"墨染突然开口，声音有些哑，带着一丝从未有过的脆弱，'),
        
        # More emotional moments between characters
        ('萧千卷身体僵了一下，但并没有推开她。\n他能感觉到少女的呼吸变得平稳而绵长——她在数据醉意中睡着了。',
         '萧千卷身体僵了一下，但并没有推开她。\n他能感觉到少女的呼吸变得平稳而绵长——她在数据醉意中睡着了。肩膀上传来的重量很轻，却让他的心变得无比沉重。他转头看了一眼墨染熟睡的脸庞，那张总是挂着不服输表情的脸，此刻显得格外安详。睫毛在篝火的映照下投下小小的阴影，嘴角还挂着一丝浅浅的笑意。\n\n萧千卷的心突然很疼。他想起了长安城里那些锦衣玉食的千金小姐，想起了她们养尊处优的模样。而眼前这个女孩，本该也过着那样的生活，却因为这个破碎的世界，不得不拿起扳手和剑，在荒原上拼命。'),
        
        ('然后，他独自一人，面对着那堆并没有温度的数字篝火，举起了手中的夜光杯。火光在杯壁上投下斑驳的影子，也在他脸上投下深深的阴影。',
         '然后，他独自一人，面对着那堆并没有温度的数字篝火，举起了手中的夜光杯。火光在杯壁上投下斑驳的影子，也在他脸上投下深深的阴影。夜风吹过，带起他的长发，在脸颊上拂过，痒痒的，却也让他更加清醒。\n\n他看着怀中熟睡的少女，眼神变得无比温柔。"我会保护好这些记忆的。"他在心中默默说道，"包括你的，也包括我们的。"'),
        
        # Enhanced battle visuals
        ('那跳动的篝火变成了烽火台上的狼烟。\n那流淌的电路湖水变成了蜿蜒流淌的黄河。\n耳边那模拟的风声，变成了凄厉的号角和战马的嘶鸣。',
         '那跳动的篝火变成了烽火台上的狼烟，浓烟滚滚，直冲云霄。\n那流淌的电路湖水变成了蜿蜒流淌的黄河，波涛汹涌，泥沙俱下。\n耳边那模拟的风声，变成了凄厉的号角和战马的嘶鸣，铁蹄声震天动地。\n整个世界都在旋转，时空仿佛错乱。他感觉自己不再是一个旁观者，而是真正站在那片千年前的战场上，感受着刀光剑影，感受着生离死别。'),
        
        ('热浪伴随着沙尘涌入，原本凉爽的空气瞬间变得灼热难耐。那份安宁和温暖，就像镜中花、水中月，转瞬即逝。',
         '热浪伴随着沙尘涌入，原本凉爽的空气瞬间变得灼热难耐，仿佛有人打开了一扇通往炼狱的大门。滚烫的气流卷起地上的尘埃，在空中形成一道道扭曲的热浪。那份安宁和温暖，就像镜中花、水中月，转瞬即逝。'),
        
        ('"该死……那些不长眼的家伙来了！"\n\n萧千卷站起身，眼神中的迷离瞬间消散，取而代之的是一种前所未有的冷冽。\n那是因为他体内的"文气醉"还在燃烧。',
         '"该死……那些不长眼的家伙来了！"\n\n萧千卷站起身，眼神中的迷离瞬间消散，取而代之的是一种前所未有的冷冽。他小心地将墨染放在一块平坦的岩石上，动作轻柔得像是在放置一件珍宝。\n那是因为他体内的"文气醉"还在燃烧。'),
        
        ('那股属于盛唐边塞的、狂暴的战意，正在他的血管里奔腾，寻找着宣泄的出口。',
         '那股属于盛唐边塞的、狂暴的战意，正在他的血管里奔腾，寻找着宣泄的出口。他能感觉到血液在沸腾，能感觉到每一个细胞都在呼啸。这一刻，他不再是那个温文尔雅的儒生，而是千年前那个醉卧沙场的狂士。'),
    ]
    
    for old, new in refinements:
        if old in content:
            content = content.replace(old, new, 1)
            print(f"  ✓ Applied refinement")
        else:
            print(f"  ✗ Not found: {old[:40]}...")
    
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(content)
    
    chinese_chars = len([c for c in content if '\u4e00' <= c <= '\u9fff'])
    print(f"  Chinese characters: {chinese_chars}")
    return chinese_chars


def refine_chapter_212():
    """Refine Chapter 212: Drunk on Battlefield"""
    filepath = 'drafts/volume_03/ch212_drunk_on_battlefield.md'
    
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()
    
    refinements = [
        # Environmental descriptions
        ('巨大的震动将半个地下绿洲的穹顶震塌。\n在那震耳欲聋的轰鸣声中，',
         '巨大的震动将半个地下绿洲的穹顶震塌。\n在那震耳欲聋的轰鸣声中，天崩地裂，整个地下世界仿佛末日降临。'),
        
        ('虽然她刚才那杯"王翰特调"喝得有点急，此时走路有点飘，脚下的每一步都像是踩在云端，',
         '虽然她刚才那杯"王翰特调"喝得有点急，此时走路有点飘，脚下的每一步都像是踩在云端。但她的眼神却异常锐利，瞳孔中闪烁着危险的光芒，宛如一只蓄势待发的猎豹，'),
        
        # Enhanced battle scenes  
        ('那些子弹擦着她的衣角飞过，只在那个紫色的残影上留下了几个涟漪。',
         '那些子弹擦着她的衣角飞过，只在那个紫色的残影上留下了几个涟漪。子弹带起的气浪吹起她的长发，几缕发丝被打断，在空中纷飞如花。但她的脸上却挂着狂野的笑容，眼中燃烧着战斗的火焰。'),
        
        ('那只巨大的光影酒杯猛地倾斜，那道被汇聚、被增强的激光束，如同倾倒的美酒一般，在空中画出一道优雅的弧线，',
         '那只巨大的光影酒杯猛地倾斜，那道被汇聚、被增强的激光束，如同倾倒的美酒一般，在空中画出一道优雅的弧线。光束所过之处，空气被瞬间电离，发出刺耳的啸叫，留下一道道炽白的灼痕，'),
        
        # Emotional moments
        ('"还有这种用法？"墨染一剑劈飞一个想要偷袭的敌人，回头惊叹，"书呆子，你这物理学得不错啊！"',
         '"还有这种用法？"墨染一剑劈飞一个想要偷袭的敌人，回头惊叹，眼中闪过一丝欣赏和骄傲，"书呆子，你这物理学得不错啊！"'),
        
        ('"诗词的解释权，归我所有。"\n萧千卷脸色微红，眼神却亮得惊人。',
         '"诗词的解释权，归我所有。"\n萧千卷脸色微红，眼神却亮得惊人。听到墨染的夸奖，他心中涌起一股暖流，但表面上依然保持着儒雅的从容。'),
        
        # Psychological portrayals
        ('那种嗜血的笑容配合她微醺的红晕，在这血色的战场上显得格外妖艳。',
         '那种嗜血的笑容配合她微醺的红晕，在这血色的战场上显得格外妖艳。她知道自己此刻的模样一定很疯狂，但她不在乎。这就是墨家的战斗方式——用技术碾压敌人，用狂野震慑对手。'),
        
        # More battle visuals
        ('短短几秒钟，剩下的十几个沙傀儡全部被点名清除。',
         '短短几秒钟，剩下的十几个沙傀儡全部被点名清除。战场上只剩下满地的红色晶体碎片，在昏暗的光线下闪烁着诡异的光芒，如同散落的星辰。'),
        
        ('那是成千上万个引擎同时发动的咆哮声，是数不清的履带碾过岩石的摩擦声。',
         '那是成千上万个引擎同时发动的咆哮声，是数不清的履带碾过岩石的摩擦声。那声音如同海啸般从四面八方涌来，震得整个地下空间都在颤抖，岩壁上的碎石簌簌落下。'),
    ]
    
    for old, new in refinements:
        if old in content:
            content = content.replace(old, new, 1)
            print(f"  ✓ Applied refinement")
        else:
            print(f"  ✗ Not found: {old[:40]}...")
    
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(content)
    
    chinese_chars = len([c for c in content if '\u4e00' <= c <= '\u9fff'])
    print(f"  Chinese characters: {chinese_chars}")
    return chinese_chars


def refine_chapter_213():
    """Refine Chapter 213: Clone Army"""
    filepath = 'drafts/volume_03/ch213_clone_army.md'
    
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()
    
    refinements = [
        # Environmental descriptions
        ('车轮碾过滚烫的沙砾，扬起两道长长的黄烟。',
         '车轮碾过滚烫的沙砾，扬起两道长长的黄烟。沙砾被高温烤得发红，踩上去发出咝咝的声响，空气中弥漫着一股焦糊的味道。'),
        
        ('在那些巨大而扭曲的黑色热导管丛林之间，',
         '在那些巨大而扭曲的黑色热导管丛林之间，热浪翻滚，将远处的景象扭曲成一片模糊的幻影。'),
        
        # Enhanced visuals
        ('这种整齐划一的丑陋，汇聚在一起，形成了一种巨大的、令人作呕的视觉冲击力。',
         '这种整齐划一的丑陋，汇聚在一起，形成了一种巨大的、令人作呕的视觉冲击力。那一千多张相同的脸在阳光下闪烁着诡异的光泽，仿佛一面面扭曲的镜子，将人性最丑陋的一面无限复制、无限放大。'),
        
        # Psychological moments
        ('墨染缓缓低下头，刘海遮住了她的眼睛。\n她的手指轻轻敲击着方向盘，发出一阵有节奏的"哒哒"声。',
         '墨染缓缓低下头，刘海遮住了她的眼睛。\n她的手指轻轻敲击着方向盘，发出一阵有节奏的"哒哒"声。那是她在极度愤怒时的习惯动作，萧千卷已经学会了识别这个信号——接下来，必定是一场血雨腥风。'),
        
        # Emotional moment
        ('"萧千卷。"\n她的声音平静得可怕。\n\n"在。"萧千卷感受到了身边少女身上散发出的滔天杀气。',
         '"萧千卷。"\n她的声音平静得可怕。\n\n"在。"萧千卷感受到了身边少女身上散发出的滔天杀气。他知道，有些人犯了不可饶恕的错误。作为同伴，他要做的不是阻止她，而是和她并肩作战。'),
        
        # Battle visuals
        ('几十枚带着长长尾焰的导弹呼啸而出，如同愤怒的黄蜂群，铺天盖地地砸向马匪最密集的区域。',
         '几十枚带着长长尾焰的导弹呼啸而出，如同愤怒的黄蜂群，铺天盖地地砸向马匪最密集的区域。导弹在空中划出一道道白色的弧线，尾焰照亮了昏暗的天空，宛如流星雨般壮观而致命。'),
        
        ('一连串的爆炸声响彻云霄。\n无数黄沙被炸飞，混合着破碎的肢体和燃烧的车辆零件，',
         '一连串的爆炸声响彻云霄。\n无数黄沙被炸飞，混合着破碎的肢体和燃烧的车辆零件。爆炸产生的冲击波形成一圈圈可见的涟漪，所过之处车辆被掀翻，沙丘被削平，'),
        
        # More action details
        ('他在空中虚踩几步，脚下金光闪烁，如同踩着无形的阶梯，在枪林弹雨中闲庭信步。',
         '他在空中虚踩几步，脚下金光闪烁，如同踩着无形的阶梯，在枪林弹雨中闲庭信步。长衫在风中猎猎作响，发丝飞扬，那一刻他仿佛不是凡人，而是从古卷中走出的谪仙，优雅而致命。'),
        
        ('那剑气并非实体，而是由高密度的激光束凝聚而成，在空中划出一道凄厉的弧线。',
         '那剑气并非实体，而是由高密度的激光束凝聚而成，在空中划出一道凄厉的弧线。剑光所过之处，空气被瞬间撕裂，发出刺耳的啸叫，如同鬼神哀鸣。'),
    ]
    
    for old, new in refinements:
        if old in content:
            content = content.replace(old, new, 1)
            print(f"  ✓ Applied refinement")
        else:
            print(f"  ✗ Not found: {old[:40]}...")
    
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(content)
    
    chinese_chars = len([c for c in content if '\u4e00' <= c <= '\u9fff'])
    print(f"  Chinese characters: {chinese_chars}")
    return chinese_chars


def refine_chapter_214():
    """Refine Chapter 214: Mechanical Camel Cavalry"""
    filepath = 'drafts/volume_03/ch214_mechanical_camel_cavalry.md'
    
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()
    
    refinements = [
        # Environmental descriptions
        ('萧千卷刚刚收剑回鞘，还没来得及享受胜利的喜悦，大地再次震颤起来。',
         '萧千卷刚刚收剑回鞘，还没来得及享受胜利的喜悦，大地再次震颤起来。周围的沙砾开始跳动，仿佛有无数看不见的鼓槌在敲击大地。'),
        
        ('这一次的震动频率低沉而有力，像是某种巨大的心脏在跳动。',
         '这一次的震动频率低沉而有力，像是某种巨大的心脏在跳动。每一次震动都让胸腔产生共鸣，让人呼吸困难，仿佛死神正一步步逼近。'),
        
        # Enhanced battle visuals
        ('每一头都有两层楼那么高，通体覆盖着厚重的反应装甲，已经被风沙打磨得铮亮。',
         '每一头都有两层楼那么高，通体覆盖着厚重的反应装甲，已经被风沙打磨得铮亮。装甲上刻满了战斗的伤痕，每一道划痕都在诉说着血与火的历史。阳光照在金属表面上，反射出刺眼的寒光。'),
        
        ('它们那巨大的关节部位露出粗壮的液压活塞，每一次踩踏地面，都会留下一个深深的坑印，并激起一片沙尘。',
         '它们那巨大的关节部位露出粗壮的液压活塞，每一次踩踏地面，都会留下一个深深的坑印，并激起一片沙尘。液压系统发出野兽般的低吼，蒸汽从关节处喷出，在空中形成白色的雾气。'),
        
        # Emotional and psychological moments
        ('"萧千卷！快跑！"\n\n墨染发出一声撕心裂肺的尖叫。',
         '"萧千卷！快跑！"\n\n墨染发出一声撕心裂肺的尖叫。那一刻，她的心脏仿佛被一只无形的大手紧紧攥住，窒息般的恐惧让她忘记了呼吸。她不怕死，但她怕失去这个一路相伴的同伴。'),
        
        ('她猛地一打方向盘，玄武号像个陀螺一样原地旋转，试图用侧面的装甲板为萧千卷挡下这第一波致命打击。',
         '她猛地一打方向盘，玄武号像个陀螺一样原地旋转，试图用侧面的装甲板为萧千卷挡下这第一波致命打击。她的动作毫不犹豫，哪怕知道这样做可能会让玄武号彻底报废，哪怕知道自己可能会丧命，她也要保护他。'),
        
        # More battle details
        ('密集的穿甲弹链和冒着白烟的火箭弹，像不要钱一样倾泻而下，形成了一道密不透风的金属风暴。',
         '密集的穿甲弹链和冒着白烟的火箭弹，像不要钱一样倾泻而下，形成了一道密不透风的金属风暴。弹幕之密集，连一只苍蝇都飞不过去。每一发子弹都拖着长长的曳光轨迹，在空中编织成一张死亡之网。'),
        
        ('那辆倒霉的改装卡车瞬间被撕成了碎片，变成了一团巨大的火球。',
         '那辆倒霉的改装卡车瞬间被撕成了碎片，变成了一团巨大的火球。爆炸的火光照亮了整个战场，高温融化了周围的沙砾，形成一片片黑色的玻璃状物质。'),
        
        # Emotional climax
        ('墨染眼神一凝，似乎下定了某种决心。\n她猛地撕开左手一直戴着的那个不起眼的黑色皮质护腕。',
         '墨染眼神一凝，似乎下定了某种决心。她知道接下来要做的事会很疼，会让她付出血的代价，但为了保护同伴，为了活下去，她愿意。\n她猛地撕开左手一直戴着的那个不起眼的黑色皮质护腕。'),
        
        ('"老爹……希望你的遗产还没过期。"\n\n墨染深吸一口气，咬紧牙关，',
         '"老爹……希望你的遗产还没过期。"\n\n墨染深吸一口气，咬紧牙关。她的手在颤抖，不是因为害怕，而是因为即将到来的剧痛。但她的眼神坚定，没有一丝犹豫。'),
        
        ('剧痛让她忍不住惨叫出声。那种痛楚像是直接把烧红的烙铁插进了神经中枢。\n鲜血顺着接口流进电路板，瞬间点亮了无数复杂的回路。',
         '剧痛让她忍不住惨叫出声。那种痛楚像是直接把烧红的烙铁插进了神经中枢，又像是有无数把刀子在血管里肆虐。她的脸色瞬间变得惨白如纸，额头冒出豆大的冷汗，顺着脸颊流下。\n鲜血顺着接口流进电路板，瞬间点亮了无数复杂的回路。血液与数据流混合，发出诡异的光芒。'),
        
        # More action visuals
        ('墨染的声音因为痛苦而变得嘶哑，但在通过车载广播传出时，却带上了一种空灵而威严的机械混响，',
         '墨染的声音因为痛苦而变得嘶哑，但在通过车载广播传出时，却带上了一种空灵而威严的机械混响。那不再是一个少女的声音，而是承载了千年传承的钜子之音，'),
    ]
    
    for old, new in refinements:
        if old in content:
            content = content.replace(old, new, 1)
            print(f"  ✓ Applied refinement")
        else:
            print(f"  ✗ Not found: {old[:40]}...")
    
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(content)
    
    chinese_chars = len([c for c in content if '\u4e00' <= c <= '\u9fff'])
    print(f"  Chinese characters: {chinese_chars}")
    return chinese_chars


def refine_chapter_215():
    """Refine Chapter 215: Sandstorm Reset"""
    filepath = 'drafts/volume_03/ch215_sandstorm_reset.md'
    
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()
    
    refinements = [
        # Environmental descriptions
        ('萧千卷站在车顶，狂风吹得他的长衫猎猎作响。\n他眯起眼睛，试图看穿那堵黑墙的本质。',
         '萧千卷站在车顶，狂风吹得他的长衫猎猎作响。\n他眯起眼睛，试图看穿那堵黑墙的本质。风沙打在脸上生疼，但他纹丝不动，目光如炬，仿佛要用眼神将那堵恐怖的黑墙撕裂。'),
        
        ('随着黑墙的逼近，他能清晰地看到，那是由无数疯狂乱舞的、黑色的二进制代码流。',
         '随着黑墙的逼近，他能清晰地看到，那是由无数疯狂乱舞的、黑色的二进制代码流。那些代码不是规则的排列，而是如同癫狂的蛇群，扭曲、翻滚、相互缠绕，散发着毁灭一切的恶意。'),
        
        ('刚才那座还耸立着的黑色热导管丛林，在接触到风暴边缘的一瞬间，就像是老旧的电影画面卡顿了一下。\n然后，消失了。\n没有爆炸，没有烟尘。',
         '刚才那座还耸立着的黑色热导管丛林，在接触到风暴边缘的一瞬间，就像是老旧的电影画面卡顿了一下。画面仿佛被按下了删除键，那庞大的建筑群从边缘开始像素化，然后一点点消融在虚空中。\n然后，消失了。\n没有爆炸，没有烟尘。甚至没有一丝声音。'),
        
        # Psychological portrayals
        ('"往那个方向跑！"\n\n萧千卷跳进副驾驶，指着雷达地图边缘一个闪烁着微弱金光的坐标。',
         '"往那个方向跑！"\n\n萧千卷跳进副驾驶，指着雷达地图边缘一个闪烁着微弱金光的坐标。他的声音很平静，但墨染能感觉到，那平静之下压抑着巨大的紧张。他的手指在微微颤抖，那是在极度集中注意力时才会有的反应。'),
        
        # Enhanced escape scene visuals
        ('玄武号那台刚刚喝饱了冷却液的引擎发出一声震耳欲聋的咆哮，身后的四个排气管同时喷出半米长的蓝色火舌。',
         '玄武号那台刚刚喝饱了冷却液的引擎发出一声震耳欲聋的咆哮，身后的四个排气管同时喷出半米长的蓝色火舌。整个车体在巨大的推力下向前一冲，车轮高速旋转，在沙地上犁出两道深深的沟壑。'),
        
        ('风暴在身后紧追不舍。\n那黑色的代码墙像是一头贪婪的巨兽，张开大嘴，吞噬着沿途的一切。',
         '风暴在身后紧追不舍。\n那黑色的代码墙像是一头贪婪的巨兽，张开大嘴，吞噬着沿途的一切。它的速度越来越快，仿佛闻到了猎物的气息，变得更加狂暴、更加急切。死亡的阴影笼罩着玄武号，那种窒息般的压迫感让人几乎无法呼吸。'),
        
        # More emotional moments
        ('玄武号的车尾已经触碰到了风暴的边缘。墨染能感觉到车身在剧烈震动，仿佛有一双看不见的大手正在试图将这辆车撕碎。',
         '玄武号的车尾已经触碰到了风暴的边缘。墨染能感觉到车身在剧烈震动，仿佛有一双看不见的大手正在试图将这辆车撕碎。她死死咬着牙，双手紧握方向盘，手背上青筋暴起。汗水模糊了视线，但她不敢眨眼，不敢有一丝松懈。'),
        
        ('那头重达五吨的钢铁巨兽，只是稍微慢了一步，就被那黑色的代码流吞没了。\n没有惨叫，没有火花。\n甚至连金属扭曲的声音都没有。',
         '那头重达五吨的钢铁巨兽，只是稍微慢了一步，就被那黑色的代码流吞没了。\n没有惨叫，没有火花。\n甚至连金属扭曲的声音都没有。它就那样静静地消失了，仿佛从未存在过。那种无声的恐怖比任何惨叫都更让人心悸。'),
        
        # Climax visuals
        ('"飞过去！"萧千卷当机立断，眼神中闪过一丝疯狂。',
         '"飞过去！"萧千卷当机立断，眼神中闪过一丝疯狂。这是唯一的机会，也是最后的机会。成功，他们就能活下去；失败，他们将堕入永恒的虚无。'),
        
        ('"你疯了？飞行模块还没修好！那是半成品！只能滑翔，飞不过去的！"墨染喊道，',
         '"你疯了？飞行模块还没修好！那是半成品！只能滑翔，飞不过去的！"墨染喊道。她的声音中带着恐惧，但更多的是不甘。她不想死，更不想看着萧千卷和自己一起死在这里。'),
        
        ('萧千卷双手结印，指尖金光大盛。他调动了全身所有的文气，甚至透支了自己的生命力，毫无保留地注入玄武号的中控系统。',
         '萧千卷双手结印，指尖金光大盛。他调动了全身所有的文气，甚至透支了自己的生命力，毫无保留地注入玄武号的中控系统。他能感觉到体内的精元在燃烧，能感觉到生命在流逝，但他没有停下。为了活下去，为了保护身边的人，他愿意付出一切代价。'),
        
        ('文气顺着电路板，瞬间流向战车两侧的隐藏翼展。',
         '文气顺着电路板，瞬间流向战车两侧的隐藏翼展。金色的能量在线路中奔腾，点亮了每一个节点，激活了每一个休眠的系统。'),
        
        # More action details
        ('玄武号在冲出断崖的最后一刻，车头猛地抬起。\n四条轮胎脱离地面，还在空转。\n但两只巨大的金属羽翼却死死地抓住了气流。',
         '玄武号在冲出断崖的最后一刻，车头猛地抬起。\n四条轮胎脱离地面，还在空转，溅起最后一片沙尘。\n但两只巨大的金属羽翼却死死地抓住了气流。羽翼展开的瞬间，发出龙吟般的金属颤音，那是机械与文气完美融合的壮丽乐章。'),
        
        ('萧千卷怒吼一声，双目充血，七窍流血。\n那是越级使用圣人战诗的反噬。',
         '萧千卷怒吼一声，双目充血，七窍流血。\n那是越级使用圣人战诗的反噬。剧痛如同万箭穿心，但他咬紧牙关，一声不吭。他的身体在颤抖，但意志却坚如磐石。'),
        
        # Ending atmospheric description
        ('那种令人窒息的压迫感消失了。\n取而代之的，是一种难以言喻的宁静与庄严。',
         '那种令人窒息的压迫感消失了。\n取而代之的，是一种难以言喻的宁静与庄严。空气中弥漫着淡淡的檀香味，那是千年香火的积淀。阳光透过云层洒下，在莫高窟的金顶上折射出万道霞光。'),
        
        ('墨染瘫在座位上，大口大口地喘着粗气，胸口剧烈起伏。',
         '墨染瘫在座位上，大口大口地喘着粗气，胸口剧烈起伏。她浑身湿透，分不清是汗水还是泪水。'),
        
        ('萧千卷顾不上擦去嘴角的血迹。\n他推开车门，跌跌撞撞地走下车。',
         '萧千卷顾不上擦去嘴角的血迹。\n他推开车门，跌跌撞撞地走下车。双腿几乎失去了知觉，每走一步都要用尽全力。但他的眼神却前所未有的明亮。'),
        
        ('那是无数代僧侣、画师、工匠，用毕生的心血和信仰凝聚而成的"人类文明备份"。',
         '那是无数代僧侣、画师、工匠，用毕生的心血和信仰凝聚而成的"人类文明备份"。每一寸岩石都承载着历史，每一个洞窟都封存着记忆。'),
    ]
    
    for old, new in refinements:
        if old in content:
            content = content.replace(old, new, 1)
            print(f"  ✓ Applied refinement")
        else:
            print(f"  ✗ Not found: {old[:40]}...")
    
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(content)
    
    chinese_chars = len([c for c in content if '\u4e00' <= c <= '\u9fff'])
    print(f"  Chinese characters: {chinese_chars}")
    return chinese_chars


def main():
    """Main function to refine all chapters"""
    print("=" * 60)
    print("Refining Chapters 211-215 of WenDao Legend")
    print("=" * 60)
    
    total_chars = 0
    
    print("\nChapter 211: 葡萄美酒夜光杯")
    print("-" * 60)
    chars = refine_chapter_211()
    total_chars += chars
    
    print("\nChapter 212: 醉卧沙场君莫笑")
    print("-" * 60)
    chars = refine_chapter_212()
    total_chars += chars
    
    print("\nChapter 213: 遭遇马匪：复制人军团")
    print("-" * 60)
    chars = refine_chapter_213()
    total_chars += chars
    
    print("\nChapter 214: 机械骆驼骑兵")
    print("-" * 60)
    chars = refine_chapter_214()
    total_chars += chars
    
    print("\nChapter 215: 沙尘暴：系统重置风暴")
    print("-" * 60)
    chars = refine_chapter_215()
    total_chars += chars
    
    print("\n" + "=" * 60)
    print(f"Refinement complete! Total Chinese characters: {total_chars}")
    print(f"Average per chapter: {total_chars // 5}")
    print("=" * 60)


if __name__ == "__main__":
    main()
